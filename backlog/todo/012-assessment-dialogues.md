# Ассесмент-диалоги — интеграция вопросов в систему диалогов

## Описание
Интегрировать ассесмент-вопросы из матрицы компетенций в существующую систему диалогов. Когда NPC-ассессор начинает ассесмент, система генерирует диалоговое дерево из вопросов AssessmentManager: NPC озвучивает ситуацию, игрок выбирает вариант ответа, NPC даёт фидбек. Сессия = 3-5 вопросов подряд с итоговым резюме.

## Definition of Ready (DOR)
- [x] Задача четко сформулирована
- [x] Определены критерии приемки
- [x] Оценена сложность (Story Points)
- [x] Нет блокирующих зависимостей
- [x] Определены необходимые ресурсы/ассеты

## Definition of Done (DOD)
- [ ] Код написан и работает
- [ ] Код соответствует стайлгайду
- [ ] Функционал протестирован вручную
- [ ] Нет консольных ошибок
- [ ] Документация обновлена (если требуется)
- [ ] Код прошел ревью (если требуется)

## Критерии приемки
1. NPC-ассессор (Петя Сеньор) может начать ассесмент-сессию через диалог
2. Вопрос отображается как сценарий (текст NPC) + варианты ответов (choices)
3. После выбора ответа NPC даёт feedback из матрицы + объяснение правильного ответа
4. Сессия состоит из 3-5 вопросов (настраивается)
5. После последнего вопроса NPC озвучивает итог сессии (средний балл, прогресс)
6. Во время ассесмента стресс/респект обновляются в реальном времени (видно в HUD)
7. Игрок может выбрать домен для ассесмента (если разблокировано несколько)
8. Если вопросы по домену закончились — NPC сообщает об этом

## Технические детали

### Подход: генерация диалогов из AssessmentManager

Не хардкодим диалоги, а генерируем их динамически. Это позволяет AssessmentManager выбирать вопросы адаптивно.

### Новый тип диалогового действия

Расширить `DialogueChoice` в `src/types/index.ts`:
```typescript
export interface DialogueChoice {
  // ... существующие поля
  startAssessment?: {
    domainId: CompetencyDomainId
    questionCount?: number  // default: 3
  }
}
```

### Изменения в UIScene (обработка диалогов)

Когда обработчик диалогов встречает `startAssessment`:

1. Вызвать `AssessmentManager.startAssessmentSession(domainId, count)`
2. Получить первый вопрос через `getNextQuestion()`
3. Сформировать диалоговую строку:
   - speaker: NPC-имя
   - text: `question.scenario + "\n\n" + question.question`
   - choices: маппинг `question.choices` → `DialogueChoice[]`
4. Каждый choice содержит action `assessmentAnswer:<questionId>:<choiceId>`
5. При выборе:
   - Вызвать `AssessmentManager.submitAnswer(questionId, choiceId)`
   - Показать feedback как следующую реплику NPC
   - Показать explanation (опционально, если score < 70)
   - Если сессия не закончена — показать следующий вопрос
   - Если закончена — показать итоговое резюме

### Формат ассесмент-диалога (как видит игрок)

```
[Петя Сеньор]: "Давай проверим, что ты знаешь по основам ML. 
                Готов? Ситуация первая..."

[Петя Сеньор]: "Ты пришёл на новый проект. Коллега обучил модель 
                предсказания оттока клиентов. Хвастается: accuracy 
                на обучающей выборке — 99.2%, на тестовой — 62.1%.
                Что скажешь коллеге?"

  > "Отличный результат! Давай деплоить."
  > "Похоже на переобучение. Попробуй регуляризацию."
  > "Переобучение. Начал бы с cross-validation и learning curves."
  > "Нужно больше данных, и всё будет ок."

[Выбирает вариант 3]

[Петя Сеньор]: "О, а ты шаришь. Именно так — сначала 
                диагностика, потом лечение."
                
[Подсказка]: "Разница между accuracy на трейне (99%) и тесте (62%) — 
              классический признак переобучения..."

[Петя Сеньор]: "Хорошо, следующая ситуация..."

... (ещё 2-4 вопроса) ...

[Петя Сеньор]: "На сегодня хватит. Твой результат по ML: 
                75/100. Неплохо! В прошлый раз было 60. 
                Растёшь!"
```

### Диалог выбора домена

Перед ассесментом NPC предлагает выбрать домен:

```
[Петя Сеньор]: "По какой теме хочешь сегодня?"

  > "Основы ML" (startAssessment: ml-fundamentals)
  > "Инженерия данных" (startAssessment: data-engineering)
  > ... (только разблокированные домены)
  > "Не сегодня" (закрыть диалог)
```

Домены разблокируются постепенно:
- Сразу доступны: ml-fundamentals, data-engineering
- После score >= 30 в любом домене: deep-learning, nlp-llms
- После score >= 50 в 3+ доменах: mlops, system-design, computer-vision
- После score >= 60 в 5+ доменах: ai-ethics

### Обработка edge-cases

- Если вопросы по домену кончились: "Ты уже ответил на все вопросы по этой теме. Молодец! Попробуй другой домен."
- Если стресс > 80 во время ассесмента: "Ты выглядишь уставшим. Может, сходи за кофе и вернёмся позже?" (прерывает сессию)
- Если игрок не выбрал AI-ветку: ассесмент-диалоги недоступны

## Зависимости
- 009-competency-matrix-types
- 010-assessment-manager
- 011-ai-career-branch (флаг aiPathUnlocked)

## Оценка
- Story Points: 8
- Приоритет: High

## Метки
- `feature`, `gameplay`, `ui`
